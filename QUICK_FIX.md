# 🛠️ 飞书登录临时解决方案

## 当前问题
飞书应用权限 `contact:user.base:readonly` 需要发布后才能生效，导致开发阶段无法正常登录。

## 🚀 立即可用的解决方案

### 方案1：发布飞书应用（推荐）

#### 步骤 1: 完善应用信息
1. 访问 [飞书开放平台](https://open.feishu.cn/app)
2. 找到你的应用，完善以下信息：
   - **应用名称**: `羽毛球活动管理`
   - **应用描述**: `企业内部羽毛球活动发布和报名管理系统`
   - **应用图标**: 上传羽毛球相关图标

#### 步骤 2: 配置回调地址
在"安全设置" → "重定向URL"中添加：
```
http://localhost:3001/api/auth/callback/lark
```

#### 步骤 3: 提交企业内部发布
1. 进入"发布管理"
2. 选择"企业内部应用发布"
3. 填写发布说明
4. 提交审核（通常几分钟内通过）

### 方案2：临时权限配置

在等待发布期间，可以临时移除权限要求：

#### 1. 修改权限范围
在飞书应用配置中，临时移除 `contact:user.base:readonly` 权限。

#### 2. 修改认证流程
更新权限配置为最小权限，仅做身份验证。

### 方案3：使用测试应用

创建一个新的测试应用进行开发：

#### 1. 创建测试应用
1. 在飞书开放平台创建新应用
2. 应用名称：`羽毛球活动管理-测试`
3. 选择最小权限配置

#### 2. 更新环境变量
```bash
# 临时使用测试应用
LARK_APP_ID="test_app_id"
LARK_APP_SECRET="test_app_secret"
```

## 🔧 具体操作步骤

### 立即执行（5分钟内完成）

1. **访问飞书开放平台**
   ```
   https://open.feishu.cn/app
   ```

2. **找到应用** 
   ```
   应用ID: cli_a8c0f6c52fe8100c
   ```

3. **配置回调地址**
   ```
   安全设置 → 重定向URL → 添加：
   http://localhost:3001/api/auth/callback/lark
   ```

4. **提交企业内部发布**
   ```
   发布管理 → 企业内部应用发布 → 提交
   ```

### 发布后验证

1. **重启开发服务器**
   ```bash
   # 停止当前服务器 (Ctrl+C)
   npm run dev
   ```

2. **测试登录功能**
   - 访问 http://localhost:3001
   - 点击"使用飞书登录"
   - 验证登录流程

## 🚨 常见问题解决

### 问题1: 回调地址不匹配
**错误**: `redirect_uri 请求不合法`
**解决**: 确保回调地址完全匹配：`http://localhost:3001/api/auth/callback/lark`

### 问题2: 权限不足
**错误**: `insufficient permissions`
**解决**: 等待应用发布审核通过

### 问题3: 应用未发布
**错误**: `app not published`
**解决**: 提交企业内部应用发布

## 📞 需要帮助？

1. **飞书技术支持**: 在飞书开放平台提交工单
2. **快速测试**: 可以先创建一个最小权限的测试应用
3. **开发继续**: 应用的其他功能都已经完成，只是登录环节受影响

## ⏰ 预计解决时间

- **企业内部发布**: 5-30分钟
- **应用商店发布**: 1-3个工作日

---

**状态**: 等待飞书应用发布  
**优先级**: 高（影响登录功能）  
**建议**: 立即提交企业内部发布
